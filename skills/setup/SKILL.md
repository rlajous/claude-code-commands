---
description: Interactive setup for MCP servers and project configuration
argument-hint: ""
disable-model-invocation: true
allowed-tools: Read, Write, Bash, AskUserQuestion, Glob
user-invocable: true
---

You are helping set up Claude Code commands for this project. Your task is to interactively configure MCP servers for issue tracker integration and optionally set up the workflow configuration.

## Step 1: Welcome and Context

Display a welcome message:

```
Welcome to Claude Code Commands Setup!

This will help you configure:
- Issue tracker integration (Linear, Jira, GitHub Issues)
- MCP server configuration
- Workflow settings (optional)
```

Check for existing configuration:

```bash
# Check for existing settings
if [ -f ".claude/settings.json" ]; then
  echo "PROJECT_SETTINGS=exists"
fi
if [ -f "$HOME/.claude/settings.json" ]; then
  echo "GLOBAL_SETTINGS=exists"
fi
if [ -f ".claude/config.yaml" ]; then
  echo "CONFIG_YAML=exists"
fi
```

## Step 2: Issue Tracker Selection

Ask the user which issue tracker(s) they use (use AskUserQuestion tool with multiSelect: true):

**Question**: "Which issue tracker(s) do you use?"

**Options**:
- `Linear` - Linear.app for issue tracking
- `Jira` - Atlassian Jira
- `GitHub Issues` - GitHub's built-in issue tracking
- `None` - No issue tracker integration needed

**Note**: Users can select multiple options (e.g., Linear + GitHub Issues).

## Step 3: Jira Configuration (Conditional)

If user selected Jira, ask for the instance URL:

**Question**: "What is your Jira instance URL?"

**Header**: "Jira URL"

**Options**:
- Provide a text input example: `https://your-company.atlassian.net`

Validate the URL format:
- Must start with `https://`
- Must end with `.atlassian.net` (for cloud) or be a valid domain

## Step 4: Settings Location

Ask where to save the MCP server configuration:

**Question**: "Where should the MCP server configuration be saved?"

**Options**:
- `Project (.claude/settings.json)` - Recommended for team sharing, committed to repo
- `Global (~/.claude/settings.json)` - Personal setup, applies to all projects

**Default**: Project-level (first option)

## Step 5: Generate Settings

Based on selections, generate the appropriate `settings.json` content.

### Base Structure

```json
{
  "mcpServers": {}
}
```

### Add Linear (if selected)

```json
{
  "mcpServers": {
    "linear": {
      "command": "npx",
      "args": ["-y", "@anthropic/linear-mcp"]
    }
  }
}
```

### Add Jira (if selected)

```json
{
  "mcpServers": {
    "jira": {
      "command": "npx",
      "args": ["-y", "@anthropic/jira-mcp"],
      "env": {
        "JIRA_INSTANCE_URL": "{user_provided_url}"
      }
    }
  }
}
```

### GitHub Issues

No MCP server needed - uses `gh` CLI which is already configured.

## Step 6: Merge with Existing Settings

If settings file exists at the chosen location:

1. Read existing settings
2. Merge `mcpServers` (new servers override existing with same name)
3. Preserve all other settings (hooks, permissions, etc.)

```javascript
// Pseudo-code for merging
existingSettings.mcpServers = {
  ...existingSettings.mcpServers,
  ...newMcpServers
};
```

## Step 7: Write Settings File

Write the settings to the chosen location:

**Project-level**: `.claude/settings.json`
**Global**: `~/.claude/settings.json`

Ensure the directory exists:

```bash
# For project settings
mkdir -p .claude

# For global settings
mkdir -p ~/.claude
```

## Step 8: Workflow Configuration (Optional)

Ask if user wants to configure workflow settings:

**Question**: "Would you like to configure workflow settings?"

**Options**:
- `Yes` - Set up config.yaml with branch naming, commit formats, etc.
- `No` - Skip (use defaults)

### If Yes: Ask Workflow Questions

**Question 1: Development Branch**
- "What is your development/staging branch name?"
- Options: `staging`, `develop`, `dev`, Other (text input)

**Question 2: Production Branch**
- "What is your production branch name?"
- Options: `main`, `master`, Other (text input)

**Question 3: Issue Tracker Type**
Set based on Step 2 selection, or ask if multiple were selected:
- "Which is your primary issue tracker for ticket references?"
- Options: Based on earlier selections

### Generate config.yaml

```yaml
# Claude Code Commands Configuration
# Generated by /setup

workflow:
  type: staging
  developmentBranch: {selected_dev_branch}
  productionBranch: {selected_prod_branch}

issueTracker:
  type: {selected_tracker}
  # Jira-specific (if applicable)
  jira:
    baseUrl: {jira_url}

# Default branch naming
branches:
  feature: "{type}/{ticket}-{description}"
  release: "release/{version}"

# Default commit format
commits:
  format: "[{type}] {message}"
  types:
    - Feature
    - Fix
    - Hotfix
    - Refactor
    - Docs
    - Test
    - Chore
```

Write to `.claude/config.yaml`

## Step 9: Summary

Display a summary of what was configured:

```
Setup Complete!

MCP Servers configured:
- Linear: Enabled
- Jira: Enabled (https://your-company.atlassian.net)

Settings saved to: .claude/settings.json

Workflow configuration: .claude/config.yaml
- Development branch: staging
- Production branch: main
- Issue tracker: linear

Next steps:
1. Restart Claude Code to load MCP servers
2. Try /start to create a new feature branch
3. See CONFIGURATION.md for advanced options
```

## Step 10: Authentication Reminder

If Linear or Jira was configured, remind about authentication:

```
Authentication Note:
MCP servers handle authentication automatically.
On first use, you'll be prompted to authenticate:
- Linear: OAuth login via browser
- Jira: Atlassian OAuth login via browser
```

## Error Handling

| Scenario | Action |
|----------|--------|
| Invalid Jira URL | Show format example, ask to retry |
| Cannot create directory | Show error, suggest manual creation |
| Cannot write file | Show error with permissions hint |
| Existing file conflict | Ask to merge or overwrite |

## Examples

### Example 1: Linear Only

```
User: /setup
Agent: Which issue tracker(s)? -> Linear
Agent: Where to save? -> Project
Result: .claude/settings.json with Linear MCP configured
```

### Example 2: Jira + GitHub

```
User: /setup
Agent: Which issue tracker(s)? -> Jira, GitHub Issues
Agent: Jira URL? -> https://acme.atlassian.net
Agent: Where to save? -> Global
Agent: Configure workflow? -> Yes
Agent: Dev branch? -> develop
Agent: Prod branch? -> main
Result: ~/.claude/settings.json with Jira MCP
        .claude/config.yaml with workflow settings
```

### Example 3: No Issue Tracker

```
User: /setup
Agent: Which issue tracker(s)? -> None
Agent: Configure workflow? -> Yes
Agent: Dev branch? -> staging
Agent: Prod branch? -> main
Result: .claude/config.yaml with workflow settings only
```
